const t=document.querySelector(".game-field").tBodies[0],e=[...t.children],n=[...t.querySelectorAll(".field-cell")],a=document.querySelector(".game-score"),s=document.querySelector(".game-best"),o=[];let l=!1,d=0,r=localStorage.getItem("best")||0,c=null,i=null,u=1;function m(){return e.map(t=>[...t.children])}function f(){return n.filter(t=>"0"===t.dataset.num)}function h(){let t=function(){let t=f();return t[Math.floor(Math.random()*t.length)]}(),e=t.dataset.id;t.dataset.num=Math.random()>=.9?4:2,o[e].textContent=t.dataset.num,o[e].classList.add(`tile--${t.dataset.num}`),o[e].classList.add("anim-show"),setTimeout(()=>o[e].classList.remove("anim-show"),500)}function g(t){let e=!1;do{e=!0;for(let n=0;n<t.length&&n!==t.length-1;n++)"0"!==t[n].dataset.num&&"0"===t[n+1].dataset.num&&(t[n+1].dataset.num=t[n].dataset.num,t[n].dataset.num=0,[t[n+1].dataset.id,t[n].dataset.id]=[t[n].dataset.id,t[n+1].dataset.id],l=!0,e=!1)}while(!e)}function L(t){for(let e=0;e<t.length;e++){let n=t[e];g(n);for(let t=2;t>=0&&t!==n.length-1;t--)if(n[t].dataset.num===n[t+1].dataset.num&&"0"!==n[t].dataset.num){let e=n[t],a=n[t+1],s=o[e.dataset.id],r=o[a.dataset.id],c=2*a.dataset.num;s.classList.remove(`tile--${e.dataset.num}`),s.textContent="",e.dataset.num=0,r.classList.remove(`tile--${a.dataset.num}`),a.dataset.num=c,r.textContent=c,r.classList.add(`tile--${c}`),r.classList.add("anim-merge"),setTimeout(()=>r.classList.remove("anim-merge"),500),l=!0,d+=c,2048===c&&document.querySelector(".message-win").classList.remove("hidden"),g(n)}}n.forEach(t=>{o[t.dataset.id].style.top=t.offsetTop+"px",o[t.dataset.id].style.left=t.offsetLeft+"px"})}function p(){L(function(){let t=[];for(let n=0;n<4;n++){let a=[];for(let t=0;t<e.length;t++)a.push(e[e.length-t-1].children[n]);t.push(a)}return t}()),l&&(h(),l=!1)}function v(){L(function(){let t=[];for(let n=0;n<4;n++){let a=[];for(let t=0;t<e.length;t++)a.push(e[t].children[n]);t.push(a)}return t}()),l&&(h(),l=!1)}function y(){L(m()),l&&(h(),l=!1)}function x(){L(m().map(t=>t.reverse())),l&&(h(),l=!1)}function S(){d>r&&(localStorage.setItem("best",d),r=d),a.textContent=d,s.textContent=r,!function(){if(f().length>0)return!0;for(let t=0;t<e.length;t++)for(let n=0;n<e.length;n++){let a=e[t].children[n].dataset.num;if(n!==e.length-1&&a===e[t].children[n+1].dataset.num||t!==e.length-1&&a===e[t+1].children[n].dataset.num)return!0}return!1}()&&document.querySelector(".message-lose").classList.remove("hidden")}s.textContent=r,function(){for(let e=0;e<n.length;e++)o.push(function(e){let n=document.createElement("div");return n.classList.add("tile"),n.style.top=e.offsetTop+"px",n.style.left=e.offsetLeft+"px",t.append(n),n}(n[e]));for(let t=0;t<n.length;t++)n[t].dataset.id=t,n[t].dataset.num=0}(),document.querySelector(".button").addEventListener("click",function(t){t.target.textContent="Restart",t.target.classList.remove("start"),t.target.classList.add("restart"),document.querySelector(".message-start").classList.add("hidden"),document.querySelector(".message-lose").classList.add("hidden"),document.querySelector(".message-win").classList.add("hidden"),n.forEach(t=>{o[t.dataset.id].textContent="",o[t.dataset.id].classList.remove(`tile--${t.dataset.num}`),t.dataset.num=0}),d=0,document.querySelector(".game-score").textContent=0,h(),h()}),document.addEventListener("keyup",function(t){switch(t.key){case"ArrowUp":p();break;case"ArrowDown":v();break;case"ArrowRight":y();break;case"ArrowLeft":x()}S()}),t.addEventListener("touchstart",function(t){let e=t.touches[0];c=e.clientX,i=e.clientY},!1),t.addEventListener("touchmove",function(t){if(!c||!i)return;let e=t.touches[0].clientX,n=t.touches[0].clientY,a=e-c,s=n-i;Math.abs(a)>Math.abs(s)?a>0?y():x():s>0?v():p(),c=null,i=null,S()},!1),document.addEventListener("touchmove",function(t){0===document.documentElement.scrollTop&&u-t.touches[0].clientY<0&&t.cancelable&&(t.preDefault(),t.stopPropagation()),u=t.touches[0].clientY},{passive:!1});
//# sourceMappingURL=index.b49c419e.js.map
